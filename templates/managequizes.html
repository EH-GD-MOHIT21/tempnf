{% load static %} {% load index %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Quizes @ NestedForm</title>
    <link rel="stylesheet" href="{% static 'creator.css' %}">
    <style>
    button{
        padding: 6px 10px;
        color: white;
        background: crimson;
        border: 1px solid gray;
        border-radius: 4px;
        font-size: 15px;
        cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        {% for id,res in data %}
        <div class="child1">
            <div class="constpart">
                <p>Quiz Id: {{id}}</p>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <h3>Responses: {{res}}</h3>
                    <button type="button" onclick="mohitfuncdel('{{id}}',this);">Delete Quiz</button>
                </div>
            </div>
            <div class="wrapperconstpart" style="overflow-x: auto;max-height:75vh;">
                {% for data in resdata|index:forloop.counter0 %}
                <div class="childconstpart">
                    <li>{{data}}</li>
                    <a href="showquizresponses/{{id}}/filter?email={{data}}">View Response</a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    <h3 style="text-align:center;color:crimson;margin:20px auto;">To manage forms <a href="/creatoraccesspage">click here</a></h3>
    <h4>{{mail}} is recorded while creating Form.</h4>
</body>
<script>
    async function mohitfuncdel(id, btn) {
        a = prompt("Type delete (small letters) for confirm delete");
        if(a!="delete")
            return;
        let response = await fetch('/deletequiz', {
            credentials: 'include',
            method: 'POST',
            mode: 'same-origin',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                "quiz_id": id,
                "email": "{{request.user.email}}"
            })
        })
        if (response.ok) {
            let json = await response.json();
            let message = json["message"]
            if (message == "success") {
                btn.parentElement.parentElement.parentElement.remove()
                    //qtotalearned
            }
            alert(message);
        } else {
            alert("HTTP-Error: " + response.status);
        }
    }
</script>

</html>